<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>متجر المكسرات</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {font-family: Arial, sans-serif; margin: 0; background: #f7faf7; color: #1f2937;}
    header {background: #fff; padding: 10px 20px; border-bottom: 1px solid #e5efe3; position: sticky; top: 0;}
    .navbar {display: flex; justify-content: space-between; align-items: center;}
    .nav-links {list-style: none; display: flex; gap: 15px; margin: 0; padding: 0;}
    .nav-links a {text-decoration: none; color: #333; padding: 5px 10px; border-radius: 6px;}
    .nav-links a:hover {background: #eaf4e4;}
    .section {padding: 20px;}
    .grid {display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;}
    .card {background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center;}
    .card img {max-width: 100%; border-radius: 8px;}
    .btn {background: #7BB661; color: #fff; border: none; padding: 8px 12px; margin-top: 10px; cursor: pointer; border-radius: 6px;}
    .btn:hover {background: #6AA153;}
    table {width: 100%; border-collapse: collapse; margin-top: 10px;}
    th, td {border: 1px solid #ddd; padding: 8px; text-align: center;}
    th {background: #f0f6ee;}
    footer {background: #f0f6ee; text-align: center; padding: 10px; margin-top: 20px;}
    /* Chat */
    .chat-box {position: fixed; bottom: 20px; right: 20px; width: 250px; background: #fff; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); display: none; flex-direction: column;}
    .chat-header {background: #7BB661; color: #fff; padding: 10px; border-radius: 10px 10px 0 0;}
    .chat-body {padding: 10px; font-size: 14px; height: 150px; overflow-y: auto;}
    .chat-input {display: flex;}
    .chat-input input {flex: 1; padding: 8px; border: none; border-top: 1px solid #ddd;}
    .chat-input button {background: #7BB661; border: none; color: #fff; padding: 8px; cursor: pointer;}
    .chat-toggle {position: fixed; bottom: 20px; right: 20px; background: #7BB661; color: #fff; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; font-size: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);}
  </style>
</head>
<body>
  <!-- الهيدر -->
  <header>
    <nav class="navbar">
      <div class="logo">🥜 متجر المكسرات</div>
      <ul class="nav-links">
        <li><a href="#types">أنواع المكسرات</a></li>
        <li><a href="#about">من نحن</a></li>
        <li><a href="#cart">السلة</a></li>
        <li><a href="#shop">الشراء</a></li>
      </ul>
    </nav>
  </header>

  <!-- الأقسام -->
  <section id="types" class="section">
    <h2>أنواع المكسرات</h2>
    <div class="grid">
      <!-- بطاقة مع كمية وزر إضافة للسلة -->
      <div class="card" data-id="p1" data-name="فستق محمّص" data-price="18">
        <img src="https://images.unsplash.com/photo-1575550959106-5a7defe28b56?q=80&w=600" alt="فستق">
        <h3>فستق محمّص</h3>
        <p class="price">₪ 18 / 100غ</p>
        <label>الكمية (غ): <input type="number" min="100" step="50" value="100" class="qty"></label>
        <button class="add-to-cart">أضف للسلة</button>
      </div>
      <div class="card" data-id="p2" data-name="لوز ممتاز" data-price="14">
        <img src="https://images.unsplash.com/photo-1601493700631-2f96f598a9a0?q=80&w=600" alt="لوز">
        <h3>لوز ممتاز</h3>
        <p class="price">₪ 14 / 100غ</p>
        <label>الكمية (غ): <input type="number" min="100" step="50" value="100" class="qty"></label>
        <button class="add-to-cart">أضف للسلة</button>
      </div>
      <div class="card" data-id="p3" data-name="كاجو مالح" data-price="22">
        <img src="https://images.unsplash.com/photo-1615486511421-c37a6c63d3e9?q=80&w=600" alt="كاجو">
        <h3>كاجو مالح</h3>
        <p class="price">₪ 22 / 100غ</p>
        <label>الكمية (غ): <input type="number" min="100" step="50" value="100" class="qty"></label>
        <button class="add-to-cart">أضف للسلة</button>
      </div>
    </div>
  </section>

  <!-- السلة -->
  <section id="cart" class="section">
    <h2>سلة التسوق</h2>
    <div class="cart-wrap">
      <table id="cartTable" style="width:100%;border-collapse:collapse">
        <thead>
          <tr>
            <th style="text-align:start;padding:8px;border-bottom:1px solid #eee">المنتج</th>
            <th style="text-align:start;padding:8px;border-bottom:1px solid #eee">السعر/100غ</th>
            <th style="text-align:start;padding:8px;border-bottom:1px solid #eee">الكمية (غ)</th>
            <th style="text-align:start;padding:8px;border-bottom:1px solid #eee">الإجمالي</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="padding:8px;text-align:start;font-weight:bold">المجموع</td>
            <td id="cartTotal" style="padding:8px;font-weight:bold">₪ 0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
      <div class="cart-actions" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="clearCart">تفريغ السلة</button>
        <button id="checkoutCOD">الدفع عند الاستلام</button>
        <button id="checkoutWA">إتمام عبر واتساب</button>
      </div>
    </div>
  </section>

  <!-- من نحن -->
  <section id="about" class="section">
    <h2>من نحن</h2>
    <p>نحن متجر متخصص ببيع المكسرات الطازجة بأفضل جودة، مع خدمة توصيل سريعة.</p>
  </section>

  <!-- الشراء -->
  <section id="shop" class="section">
    <h2>الشراء</h2>
    <form onsubmit="sendOrder(event)">
      <input type="text" id="name" placeholder="الاسم" required>
      <input type="tel" id="phone" placeholder="رقم الهاتف" required>
      <textarea id="address" placeholder="العنوان"></textarea>
      <button type="submit">تأكيد الطلب</button>
    </form>
  </section>

  <!-- دعم الدردشة -->
  <button class="chat-toggle" onclick="toggleChat()">💬</button>
  <div class="chat-box" id="chat">
    <div class="chat-header">دعم العملاء</div>
    <div class="chat-body" id="chatBody">مرحبًا! كيف يمكننا مساعدتك؟</div>
    <div class="chat-input">
      <input id="chatInput" type="text" placeholder="اكتب رسالتك...">
      <button onclick="sendMsg()">إرسال</button>
    </div>
  </div>

  <footer>
    <p>© 2025 متجر المكسرات</p>
  </footer>

  <script>
    let cart = [];

    function addToCart(name, price) {
      let item = cart.find(p => p.name === name);
      if(item){ item.qty++; } else { cart.push({name, price, qty:1}); }
      renderCart();
    }

    function renderCart(){
      const tbody = document.querySelector('#cartTable tbody');
      tbody.innerHTML = '';
      let total = 0;
      cart.forEach((item,i)=>{
        let row = `<tr>
          <td>${item.name}</td>
          <td>₪ ${item.price}</td>
          <td>${item.qty}</td>
          <td>₪ ${item.price*item.qty}</td>
          <td><button onclick="removeItem(${i})">❌</button></td>
        </tr>`;
        tbody.innerHTML += row;
        total += item.price*item.qty;
      });
      document.getElementById('total').textContent = total;
    }

    function removeItem(i){ cart.splice(i,1); renderCart(); }

    function sendOrder(e){
      e.preventDefault();
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      let orderDetails = cart.map(item => `${item.name} × ${item.qty}`).join("\n");
      let msg = `طلب جديد من ${name}\nهاتف: ${phone}\nعنوان: ${address}\n---\n${orderDetails}`;
      window.open(`https://wa.me/9647000000000?text=${encodeURIComponent(msg)}`,'_blank');
    }

    function toggleChat(){
      const chat = document.getElementById('chat');
      chat.style.display = (chat.style.display==='flex')?'none':'flex';
      chat.style.flexDirection = 'column';
    }

    function sendMsg(){
      const input = document.getElementById('chatInput');
      if(!input.value) return;
      const body = document.getElementById('chatBody');
      body.innerHTML += `<div>👤 ${input.value}</div>`;
      input.value = '';
      setTimeout(()=>{ body.innerHTML += `<div>🤖 شكرًا لتواصلك معنا</div>`; },500);
    }
  </script>
  <script>
    // === سلة بسيطة مع حفظ محلي وحساب تلقائي ===
    const CART_KEY = 'nuts_cart_v1';
    const WA_NUMBER = '9647000000000'; // ← عدّل رقمك بدون +

    const D = (sel, ctx=document)=>ctx.querySelector(sel);
    const DA = (sel, ctx=document)=>Array.from(ctx.querySelectorAll(sel));

    function money(v){ return `₪ ${v.toLocaleString('ar-IQ')}`; }

    function getCart(){ try{return JSON.parse(localStorage.getItem(CART_KEY)||'[]')}catch{return []} }
    function setCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); renderCart(); }

    // إضافة عناصر للسلة
    DA('.add-to-cart').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const card = e.target.closest('.card');
        const id = card.dataset.id;
        const name = card.dataset.name;
        const price100 = parseFloat(card.dataset.price); // سعر لكل 100غ
        const grams = parseInt(D('.qty', card).value||100,10);
        const item = {id,name,price100,grams,qty:1};
        const cart = getCart();
        const idx = cart.findIndex(x=>x.id===id && x.grams===grams);
        if(idx>-1){ cart[idx].qty += 1; } else { cart.push(item); }
        setCart(cart);
        alert(`تم إضافة ${name}`);
      });
    });

    function calcItemTotal(it){ return Math.round(it.price100 * (it.grams/100)) * it.qty; }

    function renderCart(){
      const tbody = D('#cartTable tbody'); if(!tbody) return;
      const cart = getCart();
      let total = 0;
      tbody.innerHTML = cart.map((it,i)=>{
        const line = calcItemTotal(it); total += line;
        return `<tr>
          <td style="padding:8px;border-bottom:1px solid #f2f2f2">${it.name}</td>
          <td style="padding:8px;border-bottom:1px solid #f2f2f2">${money(it.price100)}</td>
          <td style="padding:8px;border-bottom:1px solid #f2f2f2">${it.grams} × ${it.qty}</td>
          <td style="padding:8px;border-bottom:1px solid #f2f2f2">${money(line)}</td>
          <td style="padding:8px;border-bottom:1px solid #f2f2f2"><button data-rm="${i}">✕</button></td>
        </tr>`
      }).join('');
      D('#cartTotal').textContent = money(total);

      // أزرار الحذف
      DA('button[data-rm]').forEach(b=>b.addEventListener('click',()=>{
        const cart = getCart(); cart.splice(parseInt(b.dataset.rm,10),1); setCart(cart);
      }));
    }

    // تفريغ السلة
    D('#clearCart').addEventListener('click',()=> setCart([]));

    // دفع عند الاستلام (مجرد تأكيد)
    D('#checkoutCOD').addEventListener('click',()=>{
      const cart = getCart();
      if(!cart.length) return alert('سلتك فارغة');
      alert('تم استلام طلبك! سنواصل معك للتأكيد.');
    });

    // إتمام عبر واتساب مع تفاصيل السلة
    D('#checkoutWA').addEventListener('click',()=>{
      const cart = getCart();
      if(!cart.length) return alert('سلتك فارغة');
      const lines = cart.map(it=>`• ${it.name} — ${it.grams}غ × ${it.qty}`).join('
');
      const total = D('#cartTotal').textContent;
      const msg = `طلب جديد
${lines}
المجموع: ${total}`;
      const url = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url,'_blank');
    });

    // أول عرض
    renderCart();
  </script>
</body>
</html>
