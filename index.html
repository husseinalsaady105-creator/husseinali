<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>متجر المكسرات</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pistachio:#7BB661; --pistachio-600:#6AA153; --pistachio-700:#5B8C47;
      --dark:#1f2937; --muted:#6b7280; --bg:#f7faf7; --card:#ffffff; --accent:#f1f8ee; --radius:16px; --shadow:0 10px 20px rgba(0,0,0,.06)
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--dark);font-family:"Tajawal",system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    /* Header */
    header{position:sticky;top:0;z-index:60;backdrop-filter:saturate(180%) blur(8px);background:linear-gradient(to bottom, rgba(255,255,255,.95), rgba(255,255,255,.8));border-bottom:1px solid #e5efe3}
    .nav{max-width:1200px;margin:auto;display:flex;align-items:center;gap:16px;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--pistachio)}
    .brand .logo{width:36px;height:36px;border-radius:10px;background:var(--pistachio);display:grid;place-items:center;color:#fff;box-shadow:var(--shadow)}
    .nav-links{margin-inline-start:auto;display:flex;gap:8px;flex-wrap:wrap}
    .nav a{padding:8px 10px;border-radius:10px}
    .nav a:hover{background:var(--accent)}
    .cta{background:var(--pistachio);color:#fff}
    .cta:hover{background:var(--pistachio-600)}
    .lang{display:flex;gap:6px;align-items:center}
    .lang button{border:1px solid #dbe7d7;background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
    .lang button.active{background:var(--pistachio);color:#fff;border-color:transparent}
    .cart-link{position:relative}
    .cart-count{position:absolute;top:-6px;inset-inline-end:-6px;background:#d33;color:#fff;border-radius:999px;padding:0 6px;font-size:12px}

    /* Hero */
    .hero{max-width:1200px;margin:18px auto;display:grid;grid-template-columns:1.1fr .9fr;gap:20px;align-items:center;padding:0 16px}
    .hero-card{background:linear-gradient(135deg,var(--pistachio),var(--pistachio-700));color:#fff;border-radius:var(--radius);padding:24px;box-shadow:var(--shadow)}
    .hero h1{margin:0 0 6px}
    .hero p{margin:0 0 14px;opacity:.95}
    .hero .search{display:flex;background:#fff;border-radius:12px;overflow:hidden}
    .hero input{flex:1;padding:12px;border:0;outline:0;font-family:inherit}
    .hero button{border:0;background:var(--pistachio-700);color:#fff;padding:12px 16px;cursor:pointer}
    .hero-media{background:var(--card);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow)}

    /* Sections */
    section{scroll-margin-top:90px}
    .section{max-width:1200px;margin:18px auto;padding:0 16px}
    .section-title{display:flex;align-items:center;gap:8px;margin-bottom:12px}
    .pill{background:var(--accent);color:var(--pistachio-700);padding:6px 10px;border-radius:999px;font-size:13px}

    /* Products */
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .card{background:var(--card);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .thumb{aspect-ratio:1/1;border-radius:12px;background:#eef5ea;overflow:hidden}
    .title{font-weight:700;margin:10px 0 4px}
    .desc{color:var(--muted);font-size:14px;margin-bottom:6px;min-height:38px}
    .price{color:var(--pistachio-700);font-weight:700}
    .row{display:flex;gap:8px;align-items:center;margin-top:auto}
    .btn{background:var(--pistachio);color:#fff;border:0;border-radius:10px;padding:10px 12px;cursor:pointer}
    .btn.alt{background:transparent;color:var(--pistachio-700);border:1px solid var(--pistachio-600)}
    .btn:hover{filter:brightness(.98)}

    /* About & Shop */
    .about,.shop{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}

    /* Cart (page-section) */
    .cart{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #eef2ee;text-align:start}
    tfoot td{font-weight:700}

    /* Chat widget */
    .chat-fab{position:fixed;inset-inline-end:16px;inset-block-end:16px;background:var(--pistachio);color:#fff;border:0;border-radius:999px;width:56px;height:56px;display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow);z-index:80}
    .chat{position:fixed;inset-inline-end:16px;inset-block-end:80px;width:320px;background:#fff;border:1px solid #e5efe3;border-radius:14px;box-shadow:var(--shadow);display:none;flex-direction:column;overflow:hidden;z-index:80}
    .chat header{position:unset;background:var(--pistachio);color:#fff;border:0}
    .chat header .nav{padding:10px 12px}
    .chat-messages{height:260px;padding:10px;overflow:auto;background:#f8fbf7}
    .chat-input{display:flex;gap:6px;padding:10px;background:#fff;border-top:1px solid #e6efe4}
    .chat-input input{flex:1;padding:10px;border:1px solid #dbe7d7;border-radius:10px}

    footer{margin-top:26px;padding:18px 16px;background:#f0f6ee;color:#46613b}
    footer .row{max-width:1200px;margin:auto;display:flex;gap:16px;align-items:center;justify-content:space-between}

    @media (max-width: 980px){.grid{grid-template-columns:repeat(3,1fr)}.hero{grid-template-columns:1fr}}
    @media (max-width: 680px){.grid{grid-template-columns:repeat(2,1fr)}.nav-links{gap:6px}}
    @media (max-width: 430px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <nav class="nav">
      <button class="menu-btn" onclick="toggleSidebar(true)">☰</button>
      <a href="#" class="brand" aria-label="متجر المكسرات">
        <span class="logo">🥜</span>
        <span data-i18n="brand">متجر المكسرات</span>
      </a>
      <div class="nav-links">
        <a href="#types" data-i18n="nav.types">أنواع المكسرات</a>
        <a href="#about" data-i18n="nav.about">من نحن</a>
        <a href="#shop" class="cta" data-i18n="nav.buy">الشراء</a>
        <a href="#cart" class="cart-link" onclick="showSection('cart')" data-i18n="nav.cart">السلة <span id="cartCount" class="cart-count" hidden>0</span></a>
      </div>
      <div class="lang">
        <button id="btn-ar" class="active" onclick="setLang('ar')">AR</button>
        <button id="btn-en" onclick="setLang('en')">EN</button>
      </div>
    </nav>
  </header>

  <!-- Hero -->
  <div class="hero">
    <div class="hero-card">
      <h1 data-i18n="hero.title">طعم طبيعي وصحة في كل حبة</h1>
      <p data-i18n="hero.subtitle">أفضل تشكيلة من المكسرات الطازجة المحمّصة بعناية. اطلب الآن واستمتع بتوصيل سريع وجودة مضمونة.</p>
      <div class="search" role="search">
        <input type="search" id="searchInput" placeholder="فستق، لوز، كاجو…" aria-label="بحث عن منتج" />
        <button onclick="filterProducts()" aria-label="تطبيق البحث" data-i18n="actions.search">بحث</button>
      </div>
    </div>
    <div class="hero-media">
      <img src="https://images.unsplash.com/photo-1590080876138-cac52f0c8c5f?q=80&w=1200&auto=format&fit=crop" alt="وعاء مكسرات طازجة" />
    </div>
  </div>

  <!-- Products -->
  <section id="types" class="section">
    <div class="section-title">
      <span class="pill" data-i18n="products.pill">القائمة</span>
      <h2 data-i18n="products.title">أنواع المكسرات</h2>
    </div>
    <div class="grid" id="productGrid"><!-- filled by JS --></div>
  </section>

  <!-- Shop / Contact -->
  <section id="shop" class="section">
    <div class="section-title">
      <span class="pill" data-i18n="shop.pill">اطلب الآن</span>
      <h2 data-i18n="shop.title">الشراء والتواصل</h2>
    </div>
    <div class="shop">
      <form onsubmit="event.preventDefault(); placeOrder();">
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px">
          <label><span data-i18n="form.name">الاسم</span>
            <input required type="text" id="custName" placeholder="اسمك" style="width:100%;padding:10px;border:1px solid #dbe7d7;border-radius:10px;margin-top:6px" />
          </label>
          <label><span data-i18n="form.phone">رقم الهاتف</span>
            <input required type="tel" id="custPhone" placeholder="07xxxxxxx" style="width:100%;padding:10px;border:1px solid #dbe7d7;border-radius:10px;margin-top:6px" />
          </label>
          <label style="grid-column:1/-1"><span data-i18n="form.address">العنوان</span>
            <input type="text" id="custAddr" placeholder="المدينة / المنطقة / الشارع" style="width:100%;padding:10px;border:1px solid #dbe7d7;border-radius:10px;margin-top:6px" />
          </label>
          <label style="grid-column:1/-1"><span data-i18n="form.notes">ملاحظات</span>
            <textarea rows="3" id="custNotes" placeholder="مثال: بدون ملح، طحن خشن…" style="width:100%;padding:10px;border:1px solid #dbe7d7;border-radius:10px;margin-top:6px"></textarea>
          </label>
        </div>
        <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
          <button type="submit" class="btn" data-i18n="actions.confirm">تأكيد الطلب</button>
          <span style="color:var(--muted);font-size:14px" data-i18n="shop.notice">سنتصل بك لتأكيد السعر النهائي ووقت التوصيل.</span>
        </div>
      </form>
    </div>
  </section>

  <!-- About -->
  <section id="about" class="section">
    <div class="section-title">
      <span class="pill" data-i18n="about.pill">الثقة أولاً</span>
      <h2 data-i18n="about.title">من نحن</h2>
    </div>
    <div class="about">
      <p data-i18n="about.text1">نحن متجر مختص بالمكسرات الطازجة ذات الجودة العالية. نختار المحاصيل بعناية ونحمّصها محليًا لضمان النكهة والقوام المثاليين.</p>
      <ul>
        <li data-i18n="about.li1">تحميص يومي وتغليف محكم.</li>
        <li data-i18n="about.li2">خيارات بدون ملح وبدون سكر.</li>
        <li data-i18n="about.li3">توصيل داخل المدينة خلال 24 ساعة.</li>
      </ul>
    </div>
  </section>

  <!-- Cart page-section -->
  <section id="cart" class="section" style="display:none">
    <div class="section-title">
      <span class="pill" data-i18n="cart.pill">السلة</span>
      <h2 data-i18n="cart.title">سلة التسوق</h2>
    </div>
    <div class="cart">
      <table id="cartTable">
        <thead>
          <tr>
            <th data-i18n="cart.item">المنتج</th>
            <th data-i18n="cart.price">السعر/100غ</th>
            <th data-i18n="cart.qty">الكمية</th>
            <th data-i18n="cart.total">الإجمالي</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="3" data-i18n="cart.subtotal">المجموع الفرعي</td>
            <td id="cartSubtotal">0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
        <button class="btn alt" onclick="clearCart()" data-i18n="actions.clear">تفريغ السلة</button>
        <a href="#shop" class="btn" data-i18n="actions.checkout">إتمام الطلب</a>
      </div>
    </div>
  </section>

  <footer>
    <div class="row">
      <div>© <span id="year"></span> <span data-i18n="brand">متجر المكسرات</span></div>
      <div><span data-i18n="footer.whatsapp">واتساب:</span> <a id="waLink" href="https://wa.me/9647000000000" target="_blank" rel="noopener">+964 700 000 0000</a></div>
    </div>
  </footer>

  <!-- Chat -->
  <button class="chat-fab" onclick="toggleChat()">💬</button>
  <div id="chat" class="chat" aria-live="polite" aria-label="دردشة الدعم">
    <header><div class="nav"><strong data-i18n="chat.title">دعم المتجر</strong><span style="margin-inline-start:auto"></span></div></header>
    <div id="chatMessages" class="chat-messages"></div>
    <div class="chat-input">
      <input id="chatInput" type="text" placeholder="اكتب رسالتك…" data-i18n-placeholder="chat.placeholder" />
      <button class="btn" onclick="sendMsg()" data-i18n="actions.send">إرسال</button>
    </div>
  </div>

  <script>
    // ====== Data ======
    const CURRENCY = 'د.ع'; // Iraqi Dinar
    const WHATSAPP_NUMBER = '9647000000000'; // change to your number without +

    const PRODUCTS = [
      {id:'p1',cat:'pistachio',title:{ar:'فستق محمّص',en:'Roasted Pistachio'},desc:{ar:'فستق طازج محمّص بخفة.',en:'Lightly roasted fresh pistachios.'},price:18000,img:'https://images.unsplash.com/photo-1575550959106-5a7defe28b56?q=80&w=900&auto=format&fit=crop'},
      {id:'p2',cat:'almond',title:{ar:'لوز ممتاز',en:'Premium Almonds'},desc:{ar:'لوز مقرمش عالي الجودة.',en:'Crunchy, high-quality almonds.'},price:14000,img:'https://images.unsplash.com/photo-1601493700631-2f96f598a9a0?q=80&w=900&auto=format&fit=crop'},
      {id:'p3',cat:'cashew',title:{ar:'كاجو مالح',en:'Salted Cashews'},desc:{ar:'كاجو محمّص مع رشة ملح.',en:'Roasted cashews with a pinch of salt.'},price:22000,img:'https://images.unsplash.com/photo-1615486511421-c37a6c63d3e9?q=80&w=900&auto=format&fit=crop'},
      {id:'p4',cat:'hazelnut',title:{ar:'بندق محمّص',en:'Roasted Hazelnuts'},desc:{ar:'بندق غني بالنكهة.',en:'Rich-flavored hazelnuts.'},price:20000,img:'https://images.unsplash.com/photo-1602757411061-3c1a5b0b9cfb?q=80&w=900&auto=format&fit=crop'},
      {id:'p5',cat:'walnut',title:{ar:'عين الجمل',en:'Walnuts'},desc:{ar:'أنصاف عين الجمل الطازجة.',en:'Fresh walnut halves.'},price:25000,img:'https://images.unsplash.com/photo-1601000938259-d8b7921c5112?q=80&w=900&auto=format&fit=crop'},
      {id:'p6',cat:'peanut',title:{ar:'فول سوداني',en:'Peanuts'},desc:{ar:'فول سوداني محمّص.',en:'Roasted peanuts.'},price:8000,img:'https://images.unsplash.com/photo-1605482569153-3284dcaf4dd4?q=80&w=900&auto=format&fit=crop'},
      {id:'p7',cat:'mix',title:{ar:'مكس بريميوم',en:'Premium Mix'},desc:{ar:'مزيج مختار من المكسرات.',en:'Selected nut mix.'},price:24000,img:'https://images.unsplash.com/photo-1625940647693-0f1e808d07e1?q=80&w=900&auto=format&fit=crop'},
      {id:'p8',cat:'raisin',title:{ar:'زبيب ذهبي',en:'Golden Raisins'},desc:{ar:'زبيب حلو طبيعيًا.',en:'Naturally sweet raisins.'},price:6000,img:'https://images.unsplash.com/photo-1615486511438-884e758877a7?q=80&w=900&auto=format&fit=crop'}
    ];

    // ====== i18n ======
    const i18n = {
      ar:{
        brand:'متجر المكسرات',
        nav:{types:'أنواع المكسرات',about:'من نحن',buy:'الشراء',cart:'السلة'},
        hero:{title:'طعم طبيعي وصحة في كل حبة',subtitle:'أفضل تشكيلة من المكسرات الطازجة المحمّصة بعناية. اطلب الآن واستمتع بتوصيل سريع وجودة مضمونة.'},
        actions:{search:'بحث',add:'أضف للسلة',order:'طلب واتساب',send:'إرسال',clear:'تفريغ السلة',checkout:'إتمام الطلب',confirm:'تأكيد الطلب'},
        products:{pill:'القائمة',title:'أنواع المكسرات'},
        shop:{pill:'اطلب الآن',title:'الشراء والتواصل',notice:'سنتصل بك لتأكيد السعر النهائي ووقت التوصيل.'},
        form:{name:'الاسم',phone:'رقم الهاتف',address:'العنوان',notes:'ملاحظات'},
        about:{pill:'الثقة أولاً',title:'من نحن',text1:'نحن متجر مختص بالمكسرات الطازجة ذات الجودة العالية. نختار المحاصيل بعناية ونحمّصها محليًا لضمان النكهة والقوام المثاليين.',li1:'تحميص يومي وتغليف محكم.',li2:'خيارات بدون ملح وبدون سكر.',li3:'توصيل داخل المدينة خلال 24 ساعة.'},
        cart:{pill:'السلة',title:'سلة التسوق',item:'المنتج',price:'السعر/100غ',qty:'الكمية (غ)',total:'الإجمالي',subtotal:'المجموع الفرعي'},
        chat:{title:'دعم المتجر',placeholder:'اكتب رسالتك…'},
        sidebar:{title:'التصنيفات'}
      },
      en:{
        brand:'Nut Store',
        nav:{types:'Types',about:'About',buy:'Shop',cart:'Cart'},
        hero:{title:'Naturally tasty in every bite',subtitle:'The best selection of freshly roasted nuts. Order now and enjoy fast delivery and guaranteed quality.'},
        actions:{search:'Search',add:'Add to Cart',order:'Order on WhatsApp',send:'Send',clear:'Clear Cart',checkout:'Checkout',confirm:'Place Order'},
        products:{pill:'Menu',title:'Our Nuts'},
        shop:{pill:'Order Now',title:'Purchase & Contact',notice:'We will contact you to confirm final price and delivery time.'},
        form:{name:'Name',phone:'Phone',address:'Address',notes:'Notes'},
        about:{pill:'Trust First',title:'About Us',text1:'We specialize in high‑quality fresh nuts, carefully selected and roasted locally for perfect flavor and texture.',li1:'Daily roasting & sealed packs.',li2:'Salt‑free and sugar‑free options.',li3:'Citywide delivery within 24h.'},
        cart:{pill:'Cart',title:'Shopping Cart',item:'Item',price:'Price/100g',qty:'Qty (g)',total:'Total',subtotal:'Subtotal'},
        chat:{title:'Store Support',placeholder:'Type your message…'},
        sidebar:{title:'Categories'}
      }
    }

    let currentLang = 'ar';

    function setLang(lang){
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang==='ar') ? 'rtl' : 'ltr';
      document.getElementById('btn-ar').classList.toggle('active', lang==='ar');
      document.getElementById('btn-en').classList.toggle('active', lang==='en');
      applyTranslations();
      renderProducts();
      renderCart();
    }

    function t(path){
      return path.split('.').reduce((o,k)=>o&&o[k], i18n[currentLang]) || '';
    }

    function applyTranslations(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{ el.textContent = t(el.getAttribute('data-i18n')); });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{ el.setAttribute('placeholder', t(el.getAttribute('data-i18n-placeholder'))); });
    }

    // ====== Sidebar ======
    function toggleSidebar(open){
      document.getElementById('sidebar').classList.toggle('open', open);
      document.getElementById('overlay').classList.toggle('show', open);
    }

    // ====== Products render & filter ======
    function renderProducts(){
      const grid = document.getElementById('productGrid');
      const q = (document.getElementById('searchInput').value || '').toLowerCase();
      const cat = selectedCategory;
      grid.innerHTML = PRODUCTS.filter(p=>{
        const byCat = !cat || p.cat===cat;
        const title = (p.title[currentLang]||'').toLowerCase();
        return byCat && (!q || title.includes(q));
      }).map(p=>{
        return `<article class="card" data-id="${p.id}">
          <div class="thumb"><img src="${p.img}" alt="${p.title[currentLang]}"></div>
          <div class="title">${p.title[currentLang]}</div>
          <div class="desc">${p.desc[currentLang]}</div>
          <div class="price">${fmt(p.price)} / 100غ</div>
          <div class="row">
            <input type="number" min="100" step="50" value="100" style="width:90px;padding:8px;border:1px solid #dbe7d7;border-radius:10px" aria-label="الكمية بالجرام">
            <button class="btn" onclick="addToCart('${p.id}', this.previousElementSibling.value)">${t('actions.add')||'أضف للسلة'}</button>
            <button class="btn alt" onclick="orderWhatsApp('${p.id}')">${t('actions.order')||'طلب واتساب'}</button>
          </div>
        </article>`
      }).join('');
    }

    document.querySelectorAll('[data-cat]').forEach(a=>{
      a.addEventListener('click', e=>{
        const c = a.getAttribute('data-cat')||''; selectedCategory = c||null; toggleSidebar(false); renderProducts();
      });
    });

    function filterProducts(){ renderProducts(); }

    // ====== Cart ======
    const CART_KEY = 'nutstore_cart_v1';
    function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }
    function setCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartCount(); }

    function addToCart(id, grams){
      grams = parseInt(grams||100,10);
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      const cart = getCart();
      const existing = cart.find(i=>i.id===id && i.grams===grams);
      if(existing) existing.qty += 1; else cart.push({id, grams, qty:1});
      setCart(cart);
      alert((currentLang==='ar'? 'تم إضافة ':'Added ') + p.title[currentLang]);
      renderCart();
    }

    function removeItem(index){ const c=getCart(); c.splice(index,1); setCart(c); renderCart(); }
    function clearCart(){ setCart([]); renderCart(); }

    function calcPrice(p, grams){ return Math.round(p.price * (grams/100)); }

    function renderCart(){
      const tbody = document.querySelector('#cartTable tbody'); if(!tbody) return;
      const cart = getCart();
      let subtotal = 0;
      tbody.innerHTML = cart.map((item, idx)=>{
        const p = PRODUCTS.find(x=>x.id===item.id);
        const total = calcPrice(p, item.grams) * item.qty; subtotal += total;
        return `<tr>
          <td>${p.title[currentLang]}</td>
          <td>${fmt(p.price)}</td>
          <td>${item.grams} × ${item.qty}</td>
          <td>${fmt(total)}</td>
          <td><button class="btn alt" onclick="removeItem(${idx})">✕</button></td>
        </tr>`
      }).join('');
      document.getElementById('cartSubtotal').textContent = fmt(subtotal);
      updateCartCount();
    }

    function updateCartCount(){
      const n = getCart().reduce((s,i)=>s+i.qty,0);
      const el = document.getElementById('cartCount');
      if(!el) return; if(n>0){ el.hidden=false; el.textContent=n } else { el.hidden=true }
    }

    function showSection(id){
      document.querySelectorAll('section.section').forEach(s=>s.style.display='');
      document.getElementById(id).style.display='block';
      if(id==='cart') renderCart();
      document.getElementById(id).scrollIntoView({behavior:'smooth'});
    }

    function placeOrder(){
      const name = document.getElementById('custName').value.trim();
      const phone = document.getElementById('custPhone').value.trim();
      const addr = document.getElementById('custAddr').value.trim();
      const notes = document.getElementById('custNotes').value.trim();
      const cart = getCart();
      if(cart.length===0){ alert(currentLang==='ar'?'سلتك فارغة':'Your cart is empty'); return; }
      const lines = cart.map(i=>{ const p=PRODUCTS.find(x=>x.id===i.id); return `• ${p.title[currentLang]} — ${i.grams}g × ${i.qty}`}).join('\n');
      const msg = `${currentLang==='ar'?'طلب جديد':'New order'}\n${lines}\n———\n${currentLang==='ar'?'الاسم':'Name'}: ${name}\n${currentLang==='ar'?'الهاتف':'Phone'}: ${phone}\n${currentLang==='ar'?'العنوان':'Address'}: ${addr}\n${currentLang==='ar'?'ملاحظات':'Notes'}: ${notes}`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url,'_blank');
    }

    function orderWhatsApp(id){
      const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
      const msg = `${currentLang==='ar'?'أرغب في طلب':'I want to order'}: ${p.title[currentLang]} \n${currentLang==='ar'?'الكمية':'Qty'}: 100g`;
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
    }

    function fmt(v){ return Intl.NumberFormat(currentLang==='ar'?'ar-IQ':'en-US').format(v) + ' ' + CURRENCY }

    // ====== Chat (client-side demo) ======
    function toggleChat(){ const box=document.getElementById('chat'); box.style.display = (box.style.display==='flex')?'none':'flex'; }
    function sendMsg(){
      const inp = document.getElementById('chatInput'); const msg = inp.value.trim(); if(!msg) return; addChat('user', msg); inp.value='';
      setTimeout(()=>{ addChat('bot', currentLang==='ar'? 'شكرًا! سنعاود الاتصال قريبًا.' : 'Thanks! We\'ll get back to you soon.') }, 600);
    }
    function addChat(who, text){
      const box = document.getElementById('chatMessages');
      const row = document.createElement('div');
      row.style.margin='6px 0'; row.style.display='flex'; row.style.justifyContent = who==='user'?'flex-start':'flex-end';
      const b = document.createElement('div');
      b.textContent = text; b.style.padding='8px 10px'; b.style.borderRadius='10px'; b.style.maxWidth='80%';
      b.style.background = who==='user'? '#eef5ea' : '#7BB661'; b.style.color = who==='user'? '#1f2937':'#fff';
      row.appendChild(b); box.appendChild(row); box.scrollTop = box.scrollHeight;
    }

    // ====== Init ======
    let selectedCategory = null;
    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('waLink').href = `https://wa.me/${WHATSAPP_NUMBER}`;
    applyTranslations();
    renderProducts();
    updateCartCount();

    // Smooth anchor scroll
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', e=>{
        const id = a.getAttribute('href'); const el = document.querySelector(id);
        if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}); if(id==='#cart') showSection('cart'); }
      });
    });
  </script>
</body>
</html>
